<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ü–µ—á–µ–π</title>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* * CSS Variables & Reset 
         * –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ–º—ã Telegram –¥–ª—è –Ω–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏
         */
        :root {
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --text-color: var(--tg-theme-text-color, #000000);
            --hint-color: var(--tg-theme-hint-color, #999999);
            --link-color: var(--tg-theme-link-color, #2481cc);
            --button-color: var(--tg-theme-button-color, #3390ec);
            --button-text-color: var(--tg-theme-button-text-color, #ffffff);
            --secondary-bg-color: var(--tg-theme-secondary-bg-color, #f4f4f5);
            --header-bg-color: var(--tg-theme-header-bg-color, #ffffff);
            
            --radius-md: 12px;
            --radius-sm: 8px;
            --spacing-base: 16px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            font-size: 16px;
            line-height: 1.5;
            padding: var(--spacing-base);
            padding-bottom: 80px; /* –ú–µ—Å—Ç–æ –¥–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–∏ */
            min-height: 100vh;
        }

        h1 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 24px;
            text-align: center;
        }

        /* --- Form Elements --- */
        .form-section {
            margin-bottom: 24px;
        }

        .label {
            display: block;
            font-size: 14px;
            color: var(--hint-color);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-field {
            width: 100%;
            background-color: var(--secondary-bg-color);
            border: 1px solid transparent;
            border-radius: var(--radius-md);
            padding: 12px 16px;
            font-size: 16px;
            color: var(--text-color);
            outline: none;
            transition: border-color 0.2s;
        }

        .input-field:focus {
            border-color: var(--link-color);
        }

        .input-field.error {
            border-color: #ff3b30;
            background-color: rgba(255, 59, 48, 0.05);
        }

        /* --- Card Selectors (Radio Replacement) --- */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .radio-card {
            cursor: pointer;
            position: relative;
        }

        .radio-card input {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .card-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: var(--secondary-bg-color);
            border: 2px solid transparent;
            border-radius: var(--radius-md);
            padding: 12px;
            height: 100%;
            transition: all 0.2s ease;
            text-align: center;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–∞–¥–∏–æ-–∫–∞—Ä—Ç–æ—á–∫–∏ */
        .radio-card input:checked + .card-content {
            border-color: var(--button-color);
            background-color: rgba(51, 144, 236, 0.1); /* –õ–µ–≥–∫–∏–π —Ç–∏–Ω—Ç —Ü–≤–µ—Ç–∞ –∫–Ω–æ–ø–∫–∏ */
            color: var(--button-color);
            font-weight: 600;
        }

        /* –ò–∫–æ–Ω–∫–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö (CSS-only shapes) */
        .icon-box {
            margin-bottom: 6px;
            font-size: 20px;
        }

        /* --- Dimensions Grid --- */
        .dimensions-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        .dim-input-wrapper {
            position: relative;
        }

        .dim-suffix {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            color: var(--hint-color);
            pointer-events: none;
        }

        /* --- Main Button --- */
        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--bg-color);
            padding: 12px var(--spacing-base);
            /* –¢–µ–Ω—å –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ –∫–Ω–æ–ø–∫–∏ */
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05); 
            z-index: 100;
        }

        .main-button {
            width: 100%;
            background-color: var(--button-color);
            color: var(--button-text-color);
            border: none;
            padding: 14px;
            font-size: 16px;
            font-weight: 600;
            border-radius: var(--radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.2s;
        }

        .main-button:active {
            opacity: 0.8;
        }

        .main-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* --- Loader --- */
        .spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 0.8s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .main-button.loading .spinner {
            display: block;
        }

        /* --- Error Toast --- */
        .error-message {
            color: #ff3b30;
            font-size: 13px;
            margin-top: 8px;
            display: none;
            text-align: center;
        }
        
        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è */
        @media (min-width: 768px) {
            body {
                max-width: 600px;
                margin: 0 auto;
                border-left: 1px solid #eee;
                border-right: 1px solid #eee;
            }
            .bottom-bar {
                max-width: 600px;
                margin: 0 auto; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ */
            }
        }
    </style>
</head>
<body>

    <h1>–†–∞—Å—á–µ—Ç –ü–µ—á–∏</h1>

    <form id="ovenForm">
        <!-- –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ -->
        <div class="form-section">
            <label class="label" for="orderId">–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞</label>
            <input type="text" id="orderId" class="input-field" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 2024-A-15" required>
        </div>

        <!-- –¢–∏–ø –ø–µ—á–∏ -->
        <div class="form-section">
            <label class="label">–¢–∏–ø –ø–µ—á–∏</label>
            <div class="options-grid">
                <label class="radio-card">
                    <input type="radio" name="ovenType" value="gas" checked>
                    <div class="card-content">
                        <div class="icon-box">üî•</div>
                        <div>–ì–∞–∑–æ–≤–∞—è</div>
                    </div>
                </label>
                <label class="radio-card">
                    <input type="radio" name="ovenType" value="electric">
                    <div class="card-content">
                        <div class="icon-box">‚ö°</div>
                        <div>–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∞—è</div>
                    </div>
                </label>
            </div>
        </div>

        <!-- –ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
        <div class="form-section">
            <label class="label">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</label>
            <div class="options-grid">
                <label class="radio-card">
                    <input type="radio" name="constructionType" value="dead_end" checked>
                    <div class="card-content">
                        <div class="icon-box">üö™</div>
                        <div>–¢—É–ø–∏–∫–æ–≤–∞—è</div>
                        <span style="font-size: 11px; opacity: 0.7;">1 –¥–≤–µ—Ä—å</span>
                    </div>
                </label>
                <label class="radio-card">
                    <input type="radio" name="constructionType" value="through">
                    <div class="card-content">
                        <div class="icon-box">üö™üö™</div>
                        <div>–ü—Ä–æ—Ö–æ–¥–Ω–∞—è</div>
                        <span style="font-size: 11px; opacity: 0.7;">2 –¥–≤–µ—Ä–∏</span>
                    </div>
                </label>
            </div>
        </div>

        <!-- –ì–∞–±–∞—Ä–∏—Ç—ã -->
        <div class="form-section">
            <label class="label">–ì–∞–±–∞—Ä–∏—Ç—ã —Ä–∞–±–æ—á–µ–π –∑–æ–Ω—ã (–º–º)</label>
            <div class="dimensions-grid">
                <div class="dim-input-wrapper">
                    <input type="number" id="length" class="input-field" placeholder="–î–ª–∏–Ω–∞" inputmode="numeric" required>
                    <span class="dim-suffix">L</span>
                </div>
                <div class="dim-input-wrapper">
                    <input type="number" id="width" class="input-field" placeholder="–®–∏—Ä–∏–Ω–∞" inputmode="numeric" required>
                    <span class="dim-suffix">W</span>
                </div>
                <div class="dim-input-wrapper">
                    <input type="number" id="height" class="input-field" placeholder="–í—ã—Å–æ—Ç–∞" inputmode="numeric" required>
                    <span class="dim-suffix">H</span>
                </div>
            </div>
        </div>

        <div id="globalError" class="error-message">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.</div>
    </form>

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="bottom-bar">
        <button type="button" id="submitBtn" class="main-button">
            <div class="spinner"></div>
            <span id="btnText">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏–µ</span>
        </button>
    </div>

    <script>
        /**
         * CONFIGURATION
         * –ó–∞–º–µ–Ω–∏—Ç–µ URL –Ω–∏–∂–µ –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π Webhook –∏–∑ N8N
         */
        const N8N_WEBHOOK_URL = "YOUR_WEBHOOK_URL"; 

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp
        const tg = window.Telegram.WebApp;

        document.addEventListener('DOMContentLoaded', () => {
            // 1. –°–æ–æ–±—â–∞–µ–º Telegram, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ
            tg.ready();
            
            // 2. –†–∞—Å–∫—Ä—ã–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
            tg.expand();

            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–≤–µ—Ç–æ–≤ —Ö–µ–¥–µ—Ä–∞ –ø–æ–¥ —Ç–µ–º—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã)
            tg.setHeaderColor('bg_color'); 
        });

        // DOM Elements
        const submitBtn = document.getElementById('submitBtn');
        const btnText = document.getElementById('btnText');
        const globalError = document.getElementById('globalError');
        const formInputs = {
            orderId: document.getElementById('orderId'),
            length: document.getElementById('length'),
            width: document.getElementById('width'),
            height: document.getElementById('height'),
        };

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
        submitBtn.addEventListener('click', async () => {
            // –°–±—Ä–æ—Å –æ—à–∏–±–æ–∫
            globalError.style.display = 'none';
            Object.values(formInputs).forEach(input => input.classList.remove('error'));

            // –í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ (Native TWA feel)
            if (tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('light');
            }

            // 1. –í–∞–ª–∏–¥–∞—Ü–∏—è
            const errors = validateForm();
            if (errors.length > 0) {
                // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –æ—à–∏–±–æ—á–Ω—ã—Ö –ø–æ–ª–µ–π
                errors.forEach(fieldId => {
                    if(formInputs[fieldId]) formInputs[fieldId].classList.add('error');
                });
                
                globalError.textContent = "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö";
                globalError.style.display = 'block';
                
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('error');
                return;
            }

            // 2. –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
            const formData = {
                order_id: formInputs.orderId.value.trim(),
                oven_type: document.querySelector('input[name="ovenType"]:checked').value,
                construction_type: document.querySelector('input[name="constructionType"]:checked').value,
                dimensions: {
                    length: Number(formInputs.length.value),
                    width: Number(formInputs.width.value),
                    height: Number(formInputs.height.value)
                },
                timestamp: new Date().toISOString(),
                // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ N8N
                user: tg.initDataUnsafe?.user || null 
            };

            // 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            setLoading(true);

            try {
                // –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
                const response = await fetch(N8N_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    // –£—Å–ø–µ—Ö
                    if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º popup –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                    tg.showPopup({
                        title: '–£—Å–ø–µ—à–Ω–æ',
                        message: '–î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞–Ω—ã –≤ —Ä–∞—Å—á–µ—Ç–Ω—ã–π –æ—Ç–¥–µ–ª.',
                        buttons: [{type: 'ok'}]
                    }, () => {
                        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –û–ö
                        tg.close();
                    });

                } else {
                    throw new Error('Server responded with status ' + response.status);
                }

            } catch (error) {
                console.error('Error sending data:', error);
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('error');
                
                tg.showAlert(`–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.`);
            } finally {
                setLoading(false);
            }
        });

        /**
         * –§—É–Ω–∫—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
         * @returns {Array} –°–ø–∏—Å–æ–∫ ID –ø–æ–ª–µ–π —Å –æ—à–∏–±–∫–∞–º–∏
         */
        function validateForm() {
            const errors = [];
            
            // –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ –Ω–µ –ø—É—Å—Ç–æ–π
            if (!formInputs.orderId.value.trim()) {
                errors.push('orderId');
            }

            // –ì–∞–±–∞—Ä–∏—Ç—ã - —á–∏—Å–ª–∞ > 0
            ['length', 'width', 'height'].forEach(dim => {
                const val = Number(formInputs[dim].value);
                if (!val || val <= 0) {
                    errors.push(dim);
                }
            });

            return errors;
        }

        /**
         * –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∫–Ω–æ–ø–∫–∏
         * @param {boolean} isLoading 
         */
        function setLoading(isLoading) {
            if (isLoading) {
                submitBtn.classList.add('loading');
                submitBtn.disabled = true;
                btnText.textContent = "–û—Ç–ø—Ä–∞–≤–∫–∞...";
            } else {
                submitBtn.classList.remove('loading');
                submitBtn.disabled = false;
                btnText.textContent = "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏–µ";
            }
        }

    </script>
</body>
</html>