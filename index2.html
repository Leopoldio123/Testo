import math
from dataclasses import dataclass, field
from typing import List, Tuple, Optional

# --- CONFIGURATION ---
PANEL_LENGTH_MM = 6000
PANEL_THICKNESS_MM = 100
MIN_OFFCUT_LENGTH_MM = 400  # –û–±—Ä–µ–∑–∫–∏ –∫–æ—Ä–æ—á–µ —ç—Ç–æ–≥–æ —Å—á–∏—Ç–∞–µ–º –º—É—Å–æ—Ä–æ–º

@dataclass
class Offcut:
    length: int
    width: int
    source: str  # 'New Sheet' –∏–ª–∏ 'Remnant'

    def __repr__(self):
        return f"{self.length}x{self.width}"

class NestingEngine:
    def __init__(self, panel_width_mm):
        self.panel_width = panel_width_mm
        self.panel_length = PANEL_LENGTH_MM
        
        self.sheets_used = 0
        self.offcuts: List[Offcut] = []
        self.log = []  # –ñ—É—Ä–Ω–∞–ª –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –æ—Ç—á–µ—Ç–∞

    def _find_best_offcut(self, req_len: int, req_width: int) -> int:
        """
        –ò—â–µ—Ç –∏–Ω–¥–µ–∫—Å —Å–∞–º–æ–≥–æ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –æ—Å—Ç–∞—Ç–∫–∞.
        –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è –ø–ª–æ—â–∞–¥–∏ (Best Fit).
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç -1, –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.
        """
        best_idx = -1
        min_waste = float('inf')

        for i, offcut in enumerate(self.offcuts):
            if offcut.length >= req_len and offcut.width >= req_width:
                # –°—á–∏—Ç–∞–µ–º, —Å–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –ª–∏—à–Ω–µ–≥–æ, –µ—Å–ª–∏ –≤–∑—è—Ç—å —ç—Ç–æ—Ç –∫—É—Å–æ–∫
                waste = (offcut.length * offcut.width) - (req_len * req_width)
                if waste < min_waste:
                    min_waste = waste
                    best_idx = i
        
        return best_idx

    def get_piece(self, length: int, width: int, context: str):
        """
        –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: –ü–æ–ª—É—á–∏—Ç—å –∫—É—Å–æ–∫ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞.
        –°–Ω–∞—á–∞–ª–∞ –∏—â–µ—Ç –≤ –æ—Å—Ç–∞—Ç–∫–∞—Ö, –∑–∞—Ç–µ–º –±–µ—Ä–µ—Ç –Ω–æ–≤—ã–π –ª–∏—Å—Ç.
        """
        # 1. –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –≤ –æ—Å—Ç–∞—Ç–∫–∞—Ö
        idx = self._find_best_offcut(length, width)
        
        if idx != -1:
            # –ò–°–ü–û–õ–¨–ó–£–ï–ú –û–°–¢–ê–¢–û–ö
            source_piece = self.offcuts.pop(idx)
            self.log.append(f"‚ôªÔ∏è {context}: –í–∑—è—Ç –æ—Å—Ç–∞—Ç–æ–∫ {source_piece}")
            
            # –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—ã–µ –æ—Å—Ç–∞—Ç–∫–∏ –ø–æ—Å–ª–µ —Ä–µ–∑–∞
            # –°—ç–Ω–¥–≤–∏—á-–ø–∞–Ω–µ–ª–∏ –æ–±—ã—á–Ω–æ —Ä–µ–∂—É—Ç –ø–æ–ø–µ—Ä–µ–∫ (–ø–æ –¥–ª–∏–Ω–µ), –ø–æ—Ç–æ–º –≤–¥–æ–ª—å (–ø–æ —à–∏—Ä–∏–Ω–µ)
            
            # –û—Å—Ç–∞—Ç–æ–∫ –ø–æ –¥–ª–∏–Ω–µ (–æ—Å–Ω–æ–≤–Ω–æ–π –∫—É—Å–æ–∫)
            rem_len = source_piece.length - length
            if rem_len >= MIN_OFFCUT_LENGTH_MM:
                self.offcuts.append(Offcut(rem_len, source_piece.width, "Remnant"))
            
            # –û—Å—Ç–∞—Ç–æ–∫ –ø–æ —à–∏—Ä–∏–Ω–µ (—É–∑–∫–∞—è –ø–æ–ª–æ—Å–∞ –æ—Ç –≤—ã—Ä–µ–∑–∞–µ–º–æ–π —á–∞—Å—Ç–∏)
            rem_width = source_piece.width - width
            if rem_width >= 100: # –£–∑–∫–∏–µ –ø–æ–ª–æ—Å–∫–∏ –º–µ–Ω–µ–µ 100–º–º —Å—á–∏—Ç–∞–µ–º –º—É—Å–æ—Ä–æ–º
                self.offcuts.append(Offcut(length, rem_width, "Remnant"))
                
        else:
            # –ë–ï–†–ï–ú –ù–û–í–´–ô –õ–ò–°–¢
            self.sheets_used += 1
            self.log.append(f"üÜï {context}: –ù–æ–≤—ã–π –ª–∏—Å—Ç {PANEL_LENGTH_MM}x{self.panel_width}")
            
            # –û—Å—Ç–∞—Ç–æ–∫ –ø–æ –¥–ª–∏–Ω–µ
            rem_len = self.panel_length - length
            if rem_len >= MIN_OFFCUT_LENGTH_MM:
                self.offcuts.append(Offcut(rem_len, self.panel_width, "New Sheet"))
            
            # –û—Å—Ç–∞—Ç–æ–∫ –ø–æ —à–∏—Ä–∏–Ω–µ (–µ—Å–ª–∏ –æ—Ç —Ü–µ–ª–æ–≥–æ –ª–∏—Å—Ç–∞ –æ—Ç—Ä–µ–∑–∞–ª–∏ —É–∑–∫—É—é –ø–æ–ª–æ—Å—É)
            rem_width = self.panel_width - width
            if rem_width >= 100:
                self.offcuts.append(Offcut(length, rem_width, "New Sheet"))

    def process_surface(self, name: str, total_length: int, cut_length: int):
        """
        –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ –ø–æ–ª–æ—Å –Ω—É–∂–Ω–æ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏.
        total_length: –†–∞–∑–º–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –Ω–∞–±—Ä–∞—Ç—å —à–∏—Ä–∏–Ω–æ–π –ø–∞–Ω–µ–ª–µ–π.
        cut_length: –î–ª–∏–Ω–∞ –∫–∞–∂–¥–æ–≥–æ –æ—Ç—Ä–µ–∑–∞–µ–º–æ–≥–æ –∫—É—Å–∫–∞.
        """
        # –°–∫–æ–ª—å–∫–æ –ø–æ–ª–Ω—ã—Ö –ø–æ–ª–æ—Å (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —à–∏—Ä–∏–Ω—ã) –Ω—É–∂–Ω–æ?
        full_strips = total_length // self.panel_width
        # –ö–∞–∫–æ–π —à–∏—Ä–∏–Ω—ã –Ω—É–∂–Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ª–æ—Å–∞ (–¥–æ–±–æ—Ä)?
        last_strip_width = total_length % self.panel_width
        
        self.log.append(f"\nüîπ **{name}** (–ù—É–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å {total_length}–º–º –∫—É—Å–∫–∞–º–∏ –ø–æ {cut_length}–º–º):")

        # 1. –†–µ–∂–µ–º –ø–æ–ª–Ω—ã–µ –ø–æ–ª–æ—Å—ã
        for i in range(full_strips):
            self.get_piece(cut_length, self.panel_width, f"{name} (—Ü–µ–ª–∞—è –ø–æ–ª–æ—Å–∞ {i+1})")
            
        # 2. –†–µ–∂–µ–º –¥–æ–±–æ—Ä–Ω—É—é –ø–æ–ª–æ—Å—É (–µ—Å–ª–∏ –µ—Å—Ç—å)
        if last_strip_width > 0:
            self.get_piece(cut_length, last_strip_width, f"{name} (–¥–æ–±–æ—Ä {last_strip_width}–º–º)")

def calculate_oven(L: int, W: int, H: int):
    report = []
    
    # –†–∞–∑–º–µ—Ä—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞
    floor_ceil_cut_len = W + 200  # –†–µ–∂–µ–º –∫—É—Å–∫–∏ –¥–ª–∏–Ω–æ–π W+200
    floor_ceil_cover_len = L      # –ò–º–∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º –¥–ª–∏–Ω—É L
    
    wall_cut_len = H              # –†–µ–∂–µ–º –∫—É—Å–∫–∏ –≤—ã—Å–æ—Ç–æ–π H (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –º–æ–Ω—Ç–∞–∂)
    # –õ–∏–±–æ L, –µ—Å–ª–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π. –í –ø—Ä–∏–º–µ—Ä–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ª–æ–≥–∏–∫–∞ —Å–º–µ—à–∞–Ω–Ω–∞—è,
    # –Ω–æ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏ –±–µ—Ä–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –º–æ–Ω—Ç–∞–∂ –∫–∞–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –ø—Ä–æ—á–Ω–æ—Å—Ç–∏.
    # –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ (—Å—Ç–µ–Ω—ã 3500), –ø–æ–º–µ–Ω—è–π—Ç–µ wall_cut_len = L
    wall_cover_len = L            # –ó–∞–∫—Ä—ã–≤–∞–µ–º –¥–ª–∏–Ω—É L
    
    # –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞, –≥–¥–µ –æ–Ω —Ä–µ–∂–µ—Ç 3500 –Ω–∞ —Å—Ç–µ–Ω—ã:
    # –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º wall_cut_len = L, —á—Ç–æ–±—ã —Å–æ–≤–ø–∞—Å—Ç—å —Å –ª–æ–≥–∏–∫–æ–π "–∑–∞–∫—Ä—ã–≤–∞–µ–º 2000 –≤—ã—Å–æ—Ç—ã"
    # –í–ê–ñ–ù–û: –ó–¥–µ—Å—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø–æ–¥ –ª–æ–≥–∏–∫—É "–ü–∞–Ω–µ–ª–∏ –ª–µ–∂–∞—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ" –¥–ª—è —Å—Ç–µ–Ω
    # –ï—Å–ª–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ: wall_cut_len = H, wall_cover_len = L
    
    # --- –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–∞–Ω–µ–ª–∏ 1000 –º–º ---
    engine1000 = NestingEngine(1000)
    
    # 1. –ü–æ–ª
    engine1000.process_surface("–ü–æ–ª", floor_ceil_cover_len, floor_ceil_cut_len)
    # 2. –ü–æ—Ç–æ–ª–æ–∫
    engine1000.process_surface("–ü–æ—Ç–æ–ª–æ–∫", floor_ceil_cover_len, floor_ceil_cut_len)
    # 3. –°—Ç–µ–Ω—ã (2 —à—Ç) - –ø—É—Å—Ç—å –º–æ–Ω—Ç–∞–∂ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π (–ø–∞–Ω–µ–ª–∏ –¥–ª–∏–Ω–æ–π 3500 –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞)
    # –ß—Ç–æ–±—ã –∑–∞–∫—Ä—ã—Ç—å –≤—ã—Å–æ—Ç—É 2000, –Ω—É–∂–Ω–æ 2 –ø–∞–Ω–µ–ª–∏ –ø–æ 1000 —à–∏—Ä–∏–Ω–æ–π. –î–ª–∏–Ω–∞ 3500.
    engine1000.process_surface("–°—Ç–µ–Ω–∞ –õ", H, L) 
    engine1000.process_surface("–°—Ç–µ–Ω–∞ –ü", H, L)
    # 4. –¢–æ—Ä—Ü—ã (–ó–∞–¥–Ω—è—è + –î–≤–µ—Ä–∏) - –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ, –¥–ª–∏–Ω–∞ H, –∑–∞–∫—Ä—ã–≤–∞–µ–º —à–∏—Ä–∏–Ω—É W
    engine1000.process_surface("–ó–∞–¥–Ω—è—è —Å—Ç–µ–Ω–∫–∞", W, H)
    engine1000.process_surface("–î–≤–µ—Ä–∏", W, H)

    report.append(generate_report(1000, engine1000))

    # --- –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–∞–Ω–µ–ª–∏ 1190 –º–º ---
    engine1190 = NestingEngine(1190)
    
    # –¢–µ –∂–µ —à–∞–≥–∏
    engine1190.process_surface("–ü–æ–ª", floor_ceil_cover_len, floor_ceil_cut_len)
    engine1190.process_surface("–ü–æ—Ç–æ–ª–æ–∫", floor_ceil_cover_len, floor_ceil_cut_len)
    engine1190.process_surface("–°—Ç–µ–Ω–∞ –õ", H, L) 
    engine1190.process_surface("–°—Ç–µ–Ω–∞ –ü", H, L)
    engine1190.process_surface("–ó–∞–¥–Ω—è—è —Å—Ç–µ–Ω–∫–∞", W, H)
    engine1190.process_surface("–î–≤–µ—Ä–∏", W, H)

    report.append(generate_report(1190, engine1190))
    
    return "\n".join(report)

def generate_report(width, engine):
    # –§–æ—Ä–º–∏—Ä—É–µ–º –∫—Ä–∞—Å–∏–≤—ã–π Markdown
    res = f"\n=========================\n"
    res += f"üõ† **–†–ê–°–ß–ï–¢ –î–õ–Ø –ü–ê–ù–ï–õ–ò {width}–º–º**\n"
    res += f"=========================\n"
    
    # –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏)
    # res += "\n".join(engine.log) + "\n" 
    
    # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –æ—Å—Ç–∞—Ç–∫–∏ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã
    offcuts_str = []
    from collections import Counter
    counts = Counter([f"{o.length}x{o.width}" for o in engine.offcuts])
    for size, count in counts.items():
        offcuts_str.append(f"- {size}–º–º: {count} —à—Ç")
    
    if not offcuts_str:
        offcuts_str = ["–ù–µ—Ç –ø–æ–ª–µ–∑–Ω—ã—Ö –æ—Å—Ç–∞—Ç–∫–æ–≤"]

    res += f"\nüìä **–ò–¢–û–ì:**\n"
    res += f"üì¶ –í—Å–µ–≥–æ –ª–∏—Å—Ç–æ–≤ (6000x{width}): **{engine.sheets_used} —à—Ç**\n"
    res += f"‚úÇÔ∏è –û—Å—Ç–∞—Ç–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥–µ:\n" + "\n".join(offcuts_str)
    return res

# --- –ó–ê–ü–£–°–ö –î–õ–Ø –ü–†–û–í–ï–†–ö–ò (–ö–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ) ---
if __name__ == "__main__":
    # –ü—Ä–∏–º–µ—Ä –∏–∑ –ø—Ä–æ–º—Ç–∞: –î3500 —Ö –®2000 —Ö –í2000
    print(calculate_oven(3500, 2000, 2000))